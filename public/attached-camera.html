<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8" />
<title>Grow - AI Detection Recognition</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>

<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: "Poppins", sans-serif;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
  background: linear-gradient(to bottom, #50054F 0%, #060308 50%, #040404 100%);
  color: white;
}

/* HEADER */
.header {
  width: 100%;
  padding: 18px 32px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: relative;
}

.logo {
  height: 55px;
}

.title-center {
  position: absolute;
  left: 50%;
  transform: translateX(-50%);
  font-size: 28px;
  font-weight: 500;
}

.right-icons { display: flex; gap: 12px; }

.icon-btn {
  width: 38px;
  height: 38px;
  display: flex;
  justify-content: center;
  align-items: center;
  border-radius: 12px;
  border: 1px solid rgba(255,255,255,0.4);
  cursor: pointer;
  transition: 0.2s;
}

.icon-btn img { width: 22px; }

/* CAMERA GRID */
.camera-section {
  margin-top: 40px;
  margin-left: 48px;
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
}

/* ADD CARD */
.add-card {
  width: 190px;
  height: 190px;
  background: #63006a;
  border-radius: 10px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  cursor: pointer;
  transition: .2s;
}
.add-card:hover { background: #8d05ab; transform: translateY(-2px); }
.add-plus { font-size: 64px; margin-bottom: 8px; }

/* CAMERA CARD */
.camera-card {
  width: 190px;
  height: 190px;
  background: #2b032c;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.25);
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 14px;
  position: relative;
  font-size: 15px;
  transition: .2s;
  text-align: center;
}
.camera-card:hover { background: #7d0eb7; transform: translateY(-2px); }

.menu-dots {
  position: absolute;
  top: 10px;
  right: 14px;
  font-size: 22px;
  cursor: pointer;
}

/* CONTEXT MENU */
.context-menu {
  position: absolute;
  width: 110px;
  background: #3b003f;
  border-radius: 8px;
  padding: 6px 0;
  border: 1px solid rgba(255,255,255,.3);
  z-index: 500;
  display: none;
}
.context-menu div {
  padding: 7px 12px;
  cursor: pointer;
  font-size: 14px;
}
.context-menu div:hover { background: #7d0eb7; }

/* FORM OVERLAY */
#overlayDim {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,.7);
  display: none;
  z-index: 50;
}

/* FORM BOX */
.camera-form-box {
  position: fixed;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%) scale(.9);
  width: 480px;
  max-width: 92%;
  background: rgba(35,0,55,.95);
  padding: 22px;
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,.3);
  display: none;
  z-index: 60;
  opacity: 0;
  transition: .15s;
}

.camera-form-box.show {
  opacity: 1;
  transform: translate(-50%, -50%) scale(1);
}

.camera-form-box h2 {
  text-align: center;
  margin-bottom: 12px;
}

/* FORM GRID */
.form-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 16px 20px;
  margin-top: 12px;
}

.form-item { display: flex; flex-direction: column; }

.form-item label {
  font-size: 13px;
  margin-bottom: 4px;
  opacity: 0.85;
}

.form-item input {
  width: 100%;
  padding: 12px;
  border-radius: 6px;
  border: none;
  outline: none;
  font-size: 14px;
  background: #fff;
  color: #000;
}

/* FULL-WIDTH ROWS */
.form-row-full {
  margin-top: 12px;
  display: flex;
  flex-direction: column;
}

.input-with-btn {
  display: flex;
  align-items: center;
  gap: 8px;
}

.input-with-btn input {
  flex: 1;
  padding: 12px;
  border-radius: 6px;
  border: none;
  font-size: 14px;
  background: #fff;
}

/* REFRESH BUTTON */
.refresh-btn {
  width: 40px;
  height: 40px;
  border-radius: 8px;
  border: none;
  font-size: 18px;
  background: #8d05ab;
  color: #fff;
  cursor: pointer;
}
.refresh-btn:hover { background: #c300ff; }

/* PASSWORD TOGGLE */
.password-wrapper { position: relative; }

.toggle-pass {
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  cursor: pointer;
  opacity: 0.9;
  color: black !important;
  font-size: 20px;
  line-height: 1;
}
.toggle-pass:hover { opacity: 1; }

/* BUTTONS */
.btn-row {
  display: flex;
  gap: 10px;
  margin-top: 16px;
}

.save-btn, .cancel-btn {
  flex: 1;
  padding: 10px;
  border-radius: 8px;
  border: none;
  font-weight: 600;
  cursor: pointer;
  color: #fff;
}
.save-btn { background: #8d05ab; }
.cancel-btn { background: #3b003f; }
</style>
</head>

<body>

<!-- HEADER -->
<div class="header">
  <img src="images/logo/Grow logo.png" class="logo">
  <div class="title-center">ATTACHED CAMERAS</div>

  <div class="right-icons">
    <div class="icon-btn" id="dashboardBtn"><img src="images/icons/dashboard icon.png"></div>
    <div class="icon-btn" id="homeBtn"><img src="images/icons/home icon.png"></div>
  </div>
</div>

<!-- CAMERA GRID -->
<div class="camera-section" id="cameraSection"></div>

<!-- OVERLAY -->
<div id="overlayDim"></div>

<!-- CAMERA FORM -->
<div class="camera-form-box" id="cameraForm">
  <h2>Attach Camera</h2>

  <div class="form-grid">

    <div class="form-item">
      <label>Camera Name</label>
      <input id="camName">
    </div>

    <div class="form-item">
      <label>Location</label>
      <input id="camLocation">
    </div>

    <div class="form-item">
      <label>Camera IP</label>
      <input id="camIP" placeholder="192.168.1.x">
    </div>

    <div class="form-item">
      <label>HTTP Port</label>
      <input id="camHttpPort" placeholder="80">
    </div>

    <div class="form-item">
      <label>Username</label>
      <input id="camUser">
    </div>

    <div class="form-item password-wrapper">
      <label>Password</label>
      <input id="camPass" type="password">
      <span class="toggle-pass" onclick="togglePassword()">üëÅ</span>
    </div>

    <div class="form-item"></div>
    <div class="form-item"></div>

  </div>

  <!-- RTSP -->
  <div class="form-row-full">
    <label>RTSP URL</label>
    <div class="input-with-btn">
      <input id="camRTSP" placeholder="Click refresh to auto-generate">
      <button class="refresh-btn" id="refreshRTSP">‚ü≥</button>
    </div>
  </div>

  <!-- HTTP -->
  <div class="form-row-full">
    <label>HTTP URL</label>
    <div class="input-with-btn">
      <input id="camHTTP" placeholder="Click refresh to auto-generate">
      <button class="refresh-btn" id="refreshHTTP">‚ü≥</button>
    </div>
  </div>

  <div class="btn-row">
    <button class="cancel-btn" id="cancelCamera">Cancel</button>
    <button class="save-btn" id="saveCamera">Save</button>
  </div>
</div>

<!-- CONTEXT MENU -->
<div class="context-menu" id="cameraMenu">
  <div id="editCamera">Edit</div>
  <div id="deleteCamera">Delete</div>
</div>

<script>
/* NAVIGATION */
homeBtn.onclick = () => location.href = "index.html";
dashboardBtn.onclick = () => location.href = "dashboard.html";

/* STORAGE */
let cameras = JSON.parse(localStorage.getItem("cameras") || "[]");
let editIndex = null;

/* FIELDS */
const fields = {
  name: camName,
  location: camLocation,
  ip: camIP,
  httpPort: camHttpPort,
  user: camUser,
  pass: camPass,
  rtsp: camRTSP,
  http: camHTTP
};

/* PASSWORD TOGGLE */
function togglePassword() {
  const input = document.getElementById("camPass");
  input.type = input.type === "password" ? "text" : "password";
}

/* SHOW FORM */
function openForm() {
  overlayDim.style.display = "block";
  cameraForm.style.display = "block";
  requestAnimationFrame(() => cameraForm.classList.add("show"));
}

/* CLOSE FORM */
function closeForm() {
  cameraForm.classList.remove("show");
  setTimeout(() => {
    cameraForm.style.display = "none";
    overlayDim.style.display = "none";
  }, 150);

  Object.values(fields).forEach(f => f.value = "");
  editIndex = null;
}

overlayDim.onclick = closeForm;
cancelCamera.onclick = closeForm;

/* AUTO-GENERATE RTSP */
function generateRtspUrl() {
  const ip = fields.ip.value.trim();
  const user = fields.user.value.trim();
  const pass = fields.pass.value.trim();

  if (!ip || !user || !pass)
    return alert("Fill IP, username, and password first.");

  fields.rtsp.value =
    `rtsp://${encodeURIComponent(user)}:${encodeURIComponent(pass)}@${ip}:554/Streaming/Channels/101`;
}

/* AUTO-GENERATE HTTP */
function generateHttpUrl() {
  const ip = fields.ip.value.trim();
  const port = fields.httpPort.value.trim() || "80";

  if (!ip)
    return alert("Fill IP first.");

  fields.http.value =
    `http://${ip}:${port}/ISAPI/Streaming/channels/101/picture`;
}

refreshRTSP.onclick = generateRtspUrl;
refreshHTTP.onclick = generateHttpUrl;

/* CAMERA GRID */
function updateSection() {
  cameraSection.innerHTML = "";

  const addCard = document.createElement("div");
  addCard.className = "add-card";
  addCard.innerHTML = `<div class="add-plus">+</div><div>Add Camera</div>`;
  addCard.onclick = openForm;
  cameraSection.appendChild(addCard);

  cameras.forEach((cam, i) => {
    const card = document.createElement("div");
    card.className = "camera-card";

    card.innerHTML = `
      ${cam.name}
      <div class="menu-dots" data-index="${i}">‚ãÆ</div>
    `;

    /* CARD CLICK */
    card.onclick = (e) => {
      if (e.target.classList.contains("menu-dots")) return;
      alert("Preview will go here.");
    };

    /* DOTS CLICK */
    card.querySelector(".menu-dots").onclick = (e) => {
      e.stopPropagation();
      openMenu(e, i);
    };

    cameraSection.appendChild(card);
  });
}

/* CONTEXT MENU */
const cameraMenu = document.getElementById("cameraMenu");

function openMenu(e, index) {
  editIndex = index;
  cameraMenu.style.display = "block";
  cameraMenu.style.left = e.pageX + "px";
  cameraMenu.style.top = e.pageY + "px";
}

window.onclick = () => {
  cameraMenu.style.display = "none";
};

/* EDIT CAMERA */
editCamera.onclick = () => {
  const cam = cameras[editIndex];

  fields.name.value = cam.name;
  fields.location.value = cam.location;
  fields.ip.value = cam.ip;
  fields.httpPort.value = cam.httpPort;
  fields.user.value = cam.user;
  fields.pass.value = cam.pass;
  fields.rtsp.value = cam.rtsp;
  fields.http.value = cam.http;

  cameraMenu.style.display = "none";
  openForm();
};

/* DELETE CAMERA */
deleteCamera.onclick = () => {
  cameras.splice(editIndex, 1);
  localStorage.setItem("cameras", JSON.stringify(cameras));
  updateSection();
  cameraMenu.style.display = "none";
};

/* SAVE CAMERA */
saveCamera.onclick = () => {
  const cam = {
    name: fields.name.value.trim(),
    location: fields.location.value.trim(),
    ip: fields.ip.value.trim(),
    httpPort: fields.httpPort.value.trim(),
    user: fields.user.value.trim(),
    pass: fields.pass.value.trim(),
    rtsp: fields.rtsp.value.trim(),
    http: fields.http.value.trim()
  };

  if (editIndex !== null) cameras[editIndex] = cam;
  else cameras.push(cam);

  localStorage.setItem("cameras", JSON.stringify(cameras));
  updateSection();
  closeForm();
};

updateSection();
</script>

</body>
</html>